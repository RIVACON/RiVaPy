<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rivapy.marketdata.curves &mdash; rivapy  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.svg"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/index.html">Notebook Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rivapy/index.html">Module Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_data/index.html">Sample and Test Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">rivapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../marketdata.html">rivapy.marketdata</a></li>
      <li class="breadcrumb-item active">rivapy.marketdata.curves</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for rivapy.marketdata.curves</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">dateutil.relativedelta</span> <span class="k">as</span> <span class="nn">relativedelta</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">rivapy.tools.interfaces</span> <span class="k">as</span> <span class="nn">interfaces</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
    <span class="n">has_tf</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">has_tf</span> <span class="o">=</span> <span class="kc">False</span>



<span class="kn">from</span> <span class="nn">rivapy.tools.enums</span> <span class="kn">import</span> <span class="n">DayCounterType</span><span class="p">,</span> <span class="n">InterpolationType</span><span class="p">,</span> <span class="n">ExtrapolationType</span>
<span class="kn">from</span> <span class="nn">rivapy.tools.datetools</span> <span class="kn">import</span> <span class="n">DayCounter</span>
<span class="kn">from</span> <span class="nn">rivapy.marketdata.factory</span> <span class="kn">import</span> <span class="n">create</span> <span class="k">as</span> <span class="n">_create</span>

<span class="kn">from</span> <span class="nn">rivapy</span> <span class="kn">import</span> <span class="n">_pyvacon_available</span>
<span class="k">if</span> <span class="n">_pyvacon_available</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pyvacon.finance.marketdata</span> <span class="kn">import</span> <span class="n">EquityForwardCurve</span> <span class="k">as</span> <span class="n">_EquityForwardCurve</span>
    <span class="kn">from</span> <span class="nn">pyvacon.finance.marketdata</span> <span class="kn">import</span> <span class="n">SurvivalCurve</span> <span class="k">as</span> <span class="n">_SurvivalCurve</span>
    <span class="kn">from</span> <span class="nn">pyvacon.finance.marketdata</span> <span class="kn">import</span> <span class="n">DiscountCurve</span> <span class="k">as</span> <span class="n">_DiscountCurve</span>
    <span class="kn">import</span> <span class="nn">pyvacon</span> <span class="k">as</span> <span class="nn">_pyvacon</span>

<div class="viewcode-block" id="DiscountCurve"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurve">[docs]</a><span class="k">class</span> <span class="nc">DiscountCurve</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">],</span> 
                <span class="n">dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">]],</span> 
                <span class="n">df</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
                <span class="n">interpolation</span><span class="p">:</span> <span class="n">InterpolationType</span> <span class="o">=</span> <span class="n">InterpolationType</span><span class="o">.</span><span class="n">HAGAN_DF</span><span class="p">,</span>
                <span class="n">extrapolation</span><span class="p">:</span> <span class="n">ExtrapolationType</span> <span class="o">=</span> <span class="n">ExtrapolationType</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
                <span class="n">daycounter</span><span class="p">:</span> <span class="n">DayCounterType</span> <span class="o">=</span> <span class="n">DayCounterType</span><span class="o">.</span><span class="n">Act365Fixed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Discountcurve</span>

<span class="sd">        Args:</span>
<span class="sd">            id (str): Identifier of the discount curve.</span>
<span class="sd">            refdate (Union[datetime, date]): Reference date of the discount curve.</span>
<span class="sd">            dates (List[Union[datetime, date]]): List of dates belonging to the list of discount factors. All dates must be distinct and equal or after the refdate, otherwise an exception will be thrown.</span>
<span class="sd">            df (List[float]): List of discount factors. Length of list of discount factors must equal to length of list of dates, otherwise an exception will be thrown.</span>
<span class="sd">            interpolation (enums.InterpolationType, optional): Defaults to InterpolationType.HAGAN_DF.</span>
<span class="sd">            extrapolation (enums.ExtrapolationType, optional): Defaults to ExtrapolationType.NONE which does not allow to compute a discount factor for a date past all given dates given to this constructor.</span>
<span class="sd">            daycounter (enums.DayCounterType, optional): Daycounter used within the interpolation formula to compute a discount factor between two dates from the dates-list above. Defaults to DayCounterType.Act365Fixed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Please specify at least one date and discount factor&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;List of dates and discount factors must have equal length.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span><span class="n">df</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># zip dates and discount factors and sort by dates</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="n">refdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">InterpolationType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Interpolation is not of type enums.InterpolationType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extrapolation</span><span class="p">,</span> <span class="n">ExtrapolationType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Extrapolation is not of type enums.ExtrapolationType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span> <span class="o">=</span> <span class="n">extrapolation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">daycounter</span><span class="p">,</span> <span class="n">DayCounterType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Daycounter is not of type enums.DaycounterType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span> <span class="o">=</span> <span class="n">daycounter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="c1">#check if dates are monotonically increasing and if first date is greather then refdate</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">refdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;First date must be equal or greater then reference date.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">refdate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Discount factor for today must equal 1.0.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Dates must be given in monotonically increasing order.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DiscountCurve.get_dates"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurve.get_dates">[docs]</a>    <span class="k">def</span> <span class="nf">get_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return list of dates of curve</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[datetime]: List of dates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="DiscountCurve.get_df"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurve.get_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return list of discount factors</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float]: List of discount factors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="DiscountCurve.value"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurve.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return discount factor for a given date</span>

<span class="sd">        Args:</span>
<span class="sd">            refdate (Union[date, datetime]): The reference date. If the reference date is in the future (compared to the curves reference date), the forward discount factor will be returned.</span>
<span class="sd">            d (Union[date, datetime]): The date for which the discount factor will be returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: discount factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The given reference date is before the curves reference date.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pyvacon_obj</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_pyvacon_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="o">=</span> <span class="n">_DiscountCurve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> 
                                            <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dates</span><span class="p">()],</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_df</span><span class="p">()],</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">extrapolation</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span>

<div class="viewcode-block" id="DiscountCurve.plot"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurve.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">discount_factors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the discount curve using matplotlibs plot function.</span>
<span class="sd">        The timegrid includes the dates of the discount curve. Here either the discount factors or the zero rates (continuously compounded, ACT365 yearfraction) are plotted.</span>

<span class="sd">        Args:</span>
<span class="sd">            days (int, optional): The number of days between two plotted rates/discount factors. Defaults to 10.</span>
<span class="sd">            discount_factors (bool, optional): If True, discount factors will be plotted, otherwise the rates. Defaults to False.</span>
<span class="sd">            **kwargs: optional arguments that will be directly passed to the matplotlib plto function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dates</span><span class="p">()</span>
        <span class="n">dates_new</span> <span class="o">=</span> <span class="p">[</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)):</span>
            <span class="k">while</span> <span class="n">dates_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">dates_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dates_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">))</span>
        <span class="n">dates_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dates_new</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">discount_factors</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">dates_new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span><span class="o">/</span><span class="mf">365.0</span>
                <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">dt</span>
        <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates_new</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>




<div class="viewcode-block" id="NelsonSiegel"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.NelsonSiegel">[docs]</a><span class="k">class</span> <span class="nc">NelsonSiegel</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">FactoryObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                        <span class="n">beta2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nelson-Siegel parametrization for rates and yields, see :footcite:t:`Nelson1987`.</span>

<span class="sd">        This parametrization is mostly used to parametrize rate curves and can be used in conjunction with :class:`rivapy.marketdata.DiscountCurveParametrized`. It is defined by</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>

<span class="sd">            f(t) = \\beta_0 + (\\beta_1+\\beta_2)\\frac{1-e^{-t/\\tau}}{t/\\tau} -\\beta_2e^{t/\\tau}</span>


<span class="sd">        Args:</span>
<span class="sd">            beta0 (float): This parameter is the asymptotic (for arbitrary large maturities) rate, see formula above.</span>
<span class="sd">            beta1 (float): beta0 + beta1 give the short term rate, see formula above.</span>
<span class="sd">            beta2 (float): This parameter controls the size of the hump, see formula above.</span>
<span class="sd">            tau (float): This parameter controls the location of the hump, see formula above.</span>

<span class="sd">        Examples:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                &gt;&gt;&gt; from rivapy.marketdata.curves import NelsonSiegel, DiscountCurveParametrized</span>
<span class="sd">                &gt;&gt;&gt; ns = NelsonSiegel(beta0=0.05, beta1 = 0.02, beta2=0.1, tau=1.0)</span>
<span class="sd">                &gt;&gt;&gt; dc = DiscountCurveParametrized(&#39;DC&#39;,  refdate = dt.datetime(2023,1,1), rate_parametrization=ns, daycounter = DayCounterType.Act365Fixed)</span>
<span class="sd">                &gt;&gt;&gt; dates = [dt.datetime(2023,1,1) + dt.timedelta(days=30*days) for days in range(120)]</span>
<span class="sd">                &gt;&gt;&gt; values = [dc.value(refdate = dt.datetime(2023,1,1),d=d) for d in dates]</span>
<span class="sd">                &gt;&gt;&gt; plt.plot(dates, values)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta0</span> <span class="o">=</span> <span class="n">beta0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">=</span> <span class="n">beta1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">=</span> <span class="n">beta2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multiplier</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;beta0&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta0</span><span class="p">,</span> <span class="s1">&#39;beta1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> 
                <span class="s1">&#39;beta2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiplier</span><span class="o">*</span><span class="n">NelsonSiegel</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">NelsonSiegel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_multiplier</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="NelsonSiegel.compute"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.NelsonSiegel.compute">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="n">beta0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                            <span class="n">beta2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            beta0 (float): longrun</span>
<span class="sd">            beta1 (float): beta0 + beta1 = shortrun</span>
<span class="sd">            beta2 (float): hump or through</span>
<span class="sd">            tau (float):locaton of hump</span>
<span class="sd">            T (float): _description_</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span><span class="o">/</span><span class="n">tau</span>
        <span class="k">return</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">t</span> <span class="o">+</span> <span class="n">beta2</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">min_short_term_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> 
                        <span class="n">max_short_term_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.12</span><span class="p">,</span> 
                        <span class="n">min_long_run_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span> 
                        <span class="n">max_long_run_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
                        <span class="n">min_hump</span><span class="p">:</span> <span class="nb">float</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> 
                        <span class="n">max_hump</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">min_tau</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">max_tau</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">3.0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">beta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_long_run_rate</span><span class="p">,</span> <span class="n">max_long_run_rate</span><span class="p">)</span>
            <span class="n">beta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_short_term_rate</span><span class="o">-</span><span class="n">beta0</span><span class="p">,</span> <span class="n">max_short_term_rate</span><span class="o">-</span><span class="n">beta0</span><span class="p">)</span>
            <span class="n">beta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_hump</span><span class="p">,</span> <span class="n">max_hump</span><span class="p">)</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">min_tau</span><span class="p">,</span> <span class="n">max_tau</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NelsonSiegel</span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">tau</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">if</span> <span class="n">has_tf</span><span class="p">:</span>
        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">compute_tf</span><span class="p">(</span><span class="n">beta0</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">beta1</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
                                <span class="n">beta2</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">            Args:</span>
<span class="sd">                beta0 (float): longrun</span>
<span class="sd">                beta1 (float): beta0 + beta1 = shortrun</span>
<span class="sd">                beta2 (float): hump or through</span>
<span class="sd">                tau (float):locaton of hump</span>
<span class="sd">                T (float): _description_</span>

<span class="sd">            Returns:</span>
<span class="sd">                float: _description_</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span><span class="o">/</span><span class="n">tau</span>
            <span class="k">return</span> <span class="n">beta0</span> <span class="o">+</span> <span class="n">beta1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">t</span> <span class="o">+</span> <span class="n">beta2</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">t</span> <span class="o">-</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span></div>


<div class="viewcode-block" id="ConstantRate"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.ConstantRate">[docs]</a><span class="k">class</span> <span class="nc">ConstantRate</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">FactoryObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Continuously compounded flat rate object that can be used  in conjunction with :class:`rivapy.marketdata.DiscountCurveParametrized`.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            rate (float): The constant rate.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span>
        
    
    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConstantRate</span><span class="p">(</span><span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span>       
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate</span></div>

<span class="k">class</span> <span class="nc">LinearRate</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">FactoryObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shortterm_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">longterm_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_maturity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span> <span class="mf">10.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Continuously compounded linearly interpolated rate object that can be used  in conjunction with :class:`rivapy.marketdata.DiscountCurveParametrized`.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            shortterm_rate (float): The short term rate.</span>
<span class="sd">            longterm_rate (float): the longterm rate.</span>
<span class="sd">            max_maturity (float): AFer this timepoint constant extrapolation is applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortterm_rate</span> <span class="o">=</span> <span class="n">shortterm_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longterm_rate</span> <span class="o">=</span> <span class="n">longterm_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_maturity</span> <span class="o">=</span> <span class="n">max_maturity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coeff</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longterm_rate</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">shortterm_rate</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_maturity</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">shortterm_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">)</span>
            <span class="n">longterm_rate</span> <span class="o">=</span> <span class="n">shortterm_rate</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0025</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LinearRate</span><span class="p">(</span><span class="n">shortterm_rate</span><span class="o">=</span><span class="n">shortterm_rate</span><span class="p">,</span><span class="n">longterm_rate</span><span class="o">=</span><span class="n">longterm_rate</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>       
        
    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;shortterm_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortterm_rate</span><span class="p">,</span>
                <span class="s1">&#39;longterm_rate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">longterm_rate</span><span class="p">,</span>
                <span class="s1">&#39;max_maturity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_maturity</span>
                <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_maturity</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortterm_rate</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coeff</span><span class="o">*</span><span class="n">t</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">longterm_rate</span>

<div class="viewcode-block" id="NelsonSiegelSvensson"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.NelsonSiegelSvensson">[docs]</a><span class="k">class</span> <span class="nc">NelsonSiegelSvensson</span><span class="p">(</span><span class="n">NelsonSiegel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                            <span class="n">beta2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">tau2</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta3</span> <span class="o">=</span> <span class="n">beta3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau2</span> <span class="o">=</span> <span class="n">tau2</span>

    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">()</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;beta3&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta3</span><span class="p">,</span> <span class="s1">&#39;tau2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau2</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">tmp</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NelsonSiegelSvensson</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau2</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="NelsonSiegelSvensson.compute"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.NelsonSiegelSvensson.compute">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">beta3</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">tau2</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span><span class="o">/</span><span class="n">tau2</span>
        <span class="k">return</span> <span class="n">NelsonSiegel</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">beta0</span><span class="p">,</span> <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta3</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span></div></div>
    
<span class="k">class</span> <span class="nc">DiscountCurveComposition</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">FactoryObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># check if all discount curves have the same daycounter, otherwise exception</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">_create</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">_create</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">_create</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;daycounter&#39;</span><span class="p">):</span>
                <span class="n">dc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">daycounter</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;All curves must have same daycounter.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span> <span class="o">=</span> <span class="n">DayCounterType</span><span class="o">.</span><span class="n">Act365Fixed</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dc</span> <span class="o">=</span> <span class="n">DayCounter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">DiscountCurveParametrized</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ConstantRate</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">DiscountCurveParametrized</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ConstantRate</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">DiscountCurveParametrized</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ConstantRate</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;to_dict&#39;</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;to_dict&#39;</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;to_dict&#39;</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">}</span>
        
        
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">parametrization_type</span> <span class="o">=</span> <span class="n">NelsonSiegel</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
        <span class="n">curves</span> <span class="o">=</span> <span class="n">DiscountCurveParametrized</span><span class="o">.</span><span class="n">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">refdate</span><span class="p">,</span> <span class="n">parametrization_type</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curves</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_rate</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dc</span><span class="o">.</span><span class="n">yf</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">yf</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">value_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">value_rate</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">value_rate</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value_rate</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># TODO unittests</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="DiscountCurveParametrized"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurveParametrized">[docs]</a><span class="k">class</span> <span class="nc">DiscountCurveParametrized</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">FactoryObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="n">obj_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">],</span> 
                <span class="n">rate_parametrization</span><span class="p">,</span><span class="c1">#: Callable[[float], float],</span>
                <span class="n">daycounter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DayCounterType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DayCounterType</span><span class="o">.</span><span class="n">Act365Fixed</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Args:</span>
<span class="sd">            obj_id (str): _description_</span>
<span class="sd">            refdate (Union[datetime, date]): _description_</span>
<span class="sd">            rate_parametrization (Callable[[float], float]): _description_</span>
<span class="sd">            daycounter (Union[DayCounterType, str], optional): _description_. Defaults to DayCounterType.Act365Fixed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="n">refdate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span> <span class="o">=</span> <span class="n">DayCounterType</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">daycounter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dc</span> <span class="o">=</span> <span class="n">DayCounter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daycounter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_id</span> <span class="o">=</span> <span class="n">obj_id</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rate_parametrization</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="c1">#if schedule is a dict we try to create it from factory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_parametrization</span> <span class="o">=</span> <span class="n">_create</span><span class="p">(</span><span class="n">rate_parametrization</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_parametrization</span> <span class="o">=</span> <span class="n">rate_parametrization</span>
        
    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parametrization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_parametrization</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Missing implementation of to_dict() in parametrization of type &#39;</span> <span class="o">+</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_parametrization</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;obj_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_id</span><span class="p">,</span> <span class="s1">&#39;refdate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> <span class="s1">&#39;rate_parametrization&#39;</span><span class="p">:</span> <span class="n">parametrization</span><span class="p">}</span>

<div class="viewcode-block" id="DiscountCurveParametrized.value"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurveParametrized.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return discount factor for a given date</span>

<span class="sd">        Args:</span>
<span class="sd">            refdate (Union[date, datetime]): The reference date. If the reference date is in the future (compared to the curves reference date), the forward discount factor will be returned.</span>
<span class="sd">            d (Union[date, datetime]): The date for which the discount factor will be returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: discount factor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The given reference date is before the curves reference date.&#39;</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dc</span><span class="o">.</span><span class="n">yf</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_parametrization</span><span class="p">(</span><span class="n">yf</span><span class="p">)</span><span class="o">*</span><span class="n">yf</span><span class="p">)</span></div>

<div class="viewcode-block" id="DiscountCurveParametrized.value_rate"><a class="viewcode-back" href="../../../rivapy/marketdata/discountcurves.html#rivapy.marketdata.DiscountCurveParametrized.value_rate">[docs]</a>    <span class="k">def</span> <span class="nf">value_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the continuous rate for a given date</span>

<span class="sd">        Args:</span>
<span class="sd">            refdate (Union[date, datetime]): The reference date. If the reference date is in the future (compared to the curves reference date), the forward discount factor will be returned.</span>
<span class="sd">            d (Union[date, datetime]): The date for which the discount factor will be returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: continuous rate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The given reference date is before the curves reference date.&#39;</span><span class="p">)</span>
        <span class="n">yf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dc</span><span class="o">.</span><span class="n">yf</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_parametrization</span><span class="p">(</span><span class="n">yf</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">parametrization_type</span> <span class="o">=</span> <span class="n">NelsonSiegel</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">parametrizations</span> <span class="o">=</span> <span class="n">parametrization_type</span><span class="o">.</span><span class="n">_create_sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parametrizations</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DiscountCurveParametrized</span><span class="p">(</span><span class="s1">&#39;DCP_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">refdate</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DiscountCurveComposition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="EquityForwardCurve"><a class="viewcode-back" href="../../../rivapy/marketdata/equity.html#rivapy.marketdata.EquityForwardCurve">[docs]</a><span class="k">class</span> <span class="nc">EquityForwardCurve</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">spot</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                    <span class="n">funding_curve</span><span class="p">:</span> <span class="n">DiscountCurve</span><span class="p">,</span> 
                    <span class="n">borrow_curve</span><span class="p">:</span> <span class="n">DiscountCurve</span><span class="p">,</span> 
                    <span class="n">div_table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Equity Forward Curve</span>

<span class="sd">        Args:</span>
<span class="sd">            </span>
<span class="sd">            spot (float): Current spot</span>
<span class="sd">            discount_curve (DiscountCurve): [description]</span>
<span class="sd">            funding_curve (DiscountCurve): [description]</span>
<span class="sd">            borrow_curve (DiscountCurve): [description]</span>
<span class="sd">            div_table (:class:`rivapy.marketdata.DividendTable`): [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spot</span> <span class="o">=</span> <span class="n">spot</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="o">=</span> <span class="n">borrow_curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">funding_curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">div</span> <span class="o">=</span> <span class="n">div_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">refdate</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">refdate</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">refdate</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="p">,</span> <span class="s1">&#39;refdate&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">refdate</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">refdate</span>

    <span class="k">def</span> <span class="nf">_get_pyvacon_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">,</span> <span class="s1">&#39;_get_pyvacon_obj&#39;</span><span class="p">):</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="o">.</span><span class="n">_get_pyvacon_obj</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="p">,</span> <span class="s1">&#39;_get_pyvacon_obj&#39;</span><span class="p">):</span>
                <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">_get_pyvacon_obj</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="p">,</span> <span class="s1">&#39;_get_pyvacon_obj&#39;</span><span class="p">):</span>
                <span class="n">div</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">_get_pyvacon_obj</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">div</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">div</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="o">=</span> <span class="n">_EquityForwardCurve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spot</span><span class="p">,</span> <span class="n">fc</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">div</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span>
           
<div class="viewcode-block" id="EquityForwardCurve.value"><a class="viewcode-back" href="../../../rivapy/marketdata/equity.html#rivapy.marketdata.EquityForwardCurve.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">,</span> <span class="n">expiry</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pyvacon_obj</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">refdate</span><span class="p">,</span> <span class="n">expiry</span><span class="p">)</span></div>

<div class="viewcode-block" id="EquityForwardCurve.plot"><a class="viewcode-back" href="../../../rivapy/marketdata/equity.html#rivapy.marketdata.EquityForwardCurve.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">days_end</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="mi">365</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the forward curve using matplotlibs plot function.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            days (int, optional): The number of days between two plotted rates/discount factors. Defaults to 10.</span>
<span class="sd">            days_end (int. optional): Number of days when plotting will end. Defaults to 10*365 (10yr)</span>
<span class="sd">            **kwargs: optional arguments that will be directly passed to the matplotlib plto function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">days_end</span><span class="p">,</span> <span class="n">days</span><span class="p">)]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;expiry&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;forward value&#39;</span><span class="p">)</span></div></div>

<span class="k">class</span> <span class="nc">BootstrapHazardCurve</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">ref_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> 
                    <span class="n">trade_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
                    <span class="n">dc</span><span class="p">:</span> <span class="n">DiscountCurve</span><span class="p">,</span>
                    <span class="n">RR</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">payment_dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span>
                    <span class="n">market_spreads</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">        Args:</span>
<span class="sd">            ref_date (datetime): [description]</span>
<span class="sd">            trade_date (datetime): [description]</span>
<span class="sd">            dc (DiscountCurve): [description]</span>
<span class="sd">            RR (float): [description]</span>
<span class="sd">            payment_dates (List[datetime]): [description]</span>
<span class="sd">            market_spreads (List[float]): [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>                      

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="o">=</span><span class="n">ref_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trade_date</span><span class="o">=</span><span class="n">trade_date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">=</span><span class="n">dc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RR</span><span class="o">=</span><span class="n">RR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payment_dates_bootstrapp</span><span class="o">=</span><span class="n">payment_dates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">market_spreads</span><span class="o">=</span><span class="n">market_spreads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pyvacon_obj</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">par_spread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dc_survival</span><span class="p">,</span> <span class="n">maturity_date</span><span class="p">,</span> <span class="n">payment_dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">]):</span>
        <span class="n">integration_step</span><span class="o">=</span> <span class="n">relativedelta</span><span class="o">.</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
        <span class="n">premium_period_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span>
        <span class="n">prev_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span>
        <span class="n">current_date</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">prev_date</span><span class="o">+</span><span class="n">integration_step</span><span class="p">,</span> <span class="n">maturity_date</span><span class="p">)</span>
        <span class="n">dc_valuation_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">maturity_date</span><span class="p">)</span>
        <span class="n">risk_adj_factor_protection</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">risk_adj_factor_premium</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">risk_adj_factor_accrued</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">maturity_date</span><span class="p">:</span>
            <span class="n">default_prob</span> <span class="o">=</span> <span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">prev_date</span><span class="p">)</span><span class="o">-</span><span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">current_date</span><span class="p">)</span>
            <span class="n">risk_adj_factor_protection</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">current_date</span><span class="p">)</span> <span class="o">*</span> <span class="n">default_prob</span>
            <span class="n">prev_date</span> <span class="o">=</span> <span class="n">current_date</span>
            <span class="n">current_date</span> <span class="o">+=</span> <span class="n">integration_step</span>
        
        <span class="k">if</span> <span class="n">prev_date</span> <span class="o">&lt;</span> <span class="n">maturity_date</span> <span class="ow">and</span> <span class="n">current_date</span> <span class="o">&gt;</span> <span class="n">maturity_date</span><span class="p">:</span>
            <span class="n">default_prob</span> <span class="o">=</span> <span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">prev_date</span><span class="p">)</span><span class="o">-</span><span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">maturity_date</span><span class="p">)</span>
            <span class="n">risk_adj_factor_protection</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">maturity_date</span><span class="p">)</span>  <span class="o">*</span> <span class="n">default_prob</span>

        <span class="k">for</span> <span class="n">premium_payment</span> <span class="ow">in</span> <span class="n">payment_dates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">premium_payment</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">:</span>
                <span class="n">period_length</span> <span class="o">=</span> <span class="p">((</span><span class="n">premium_payment</span><span class="o">-</span><span class="n">premium_period_start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span><span class="o">/</span><span class="mi">360</span>
                <span class="n">survival_prob</span> <span class="o">=</span> <span class="p">(</span><span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">premium_period_start</span><span class="p">)</span><span class="o">+</span><span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">premium_payment</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">premium_payment</span><span class="p">)</span>
                <span class="n">risk_adj_factor_premium</span> <span class="o">+=</span> <span class="n">period_length</span><span class="o">*</span><span class="n">survival_prob</span><span class="o">*</span><span class="n">df</span>
                <span class="n">default_prob</span> <span class="o">=</span> <span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">premium_period_start</span><span class="p">)</span><span class="o">-</span><span class="n">dc_survival</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">premium_payment</span><span class="p">)</span>
                <span class="n">risk_adj_factor_accrued</span> <span class="o">+=</span> <span class="n">period_length</span><span class="o">*</span><span class="n">default_prob</span><span class="o">*</span><span class="n">df</span>
                <span class="n">premium_period_start</span> <span class="o">=</span> <span class="n">premium_payment</span>

        <span class="n">PV_accrued</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">risk_adj_factor_accrued</span><span class="p">)</span>
        <span class="n">PV_premium</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">risk_adj_factor_premium</span>
        <span class="n">PV_protection</span><span class="o">=</span><span class="p">(((</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">RR</span><span class="p">))</span><span class="o">*</span><span class="n">risk_adj_factor_protection</span><span class="p">)</span>
        
        <span class="n">par_spread_i</span><span class="o">=</span><span class="p">(</span><span class="n">PV_protection</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">PV_premium</span><span class="o">+</span><span class="n">PV_accrued</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">par_spread_i</span>

    <span class="k">def</span> <span class="nf">create_survival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span> <span class="n">hazard_rates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">_SurvivalCurve</span><span class="p">(</span><span class="s1">&#39;survival_curve&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">hazard_rates</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">calibration_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mkt_par_spread</span><span class="p">,</span> <span class="n">ref_date</span><span class="p">,</span> <span class="n">payment_dates</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">hazard_rates</span><span class="p">):</span>
        <span class="n">hazard_rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">maturity_date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dc_surv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_survival</span><span class="p">(</span><span class="n">ref_date</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">hazard_rates</span><span class="p">)</span>
        <span class="k">return</span>  <span class="n">mkt_par_spread</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_spread</span><span class="p">(</span><span class="n">dc_surv</span><span class="p">,</span> <span class="n">maturity_date</span><span class="p">,</span> <span class="n">payment_dates</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">calibrate_hazard_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sc_dates</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">]</span>
        <span class="n">hazard_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_dates_bootstrapp</span><span class="p">)):</span>
            <span class="n">payment_dates_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_dates_bootstrapp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">mkt_par_spread_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">market_spreads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sc_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">payment_dates_iter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">hazard_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hazard_rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">sol</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration_error</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mkt_par_spread_iter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_date</span><span class="p">,</span> 
                            <span class="n">payment_dates_iter</span><span class="p">,</span> <span class="n">sc_dates</span><span class="p">,</span> <span class="n">hazard_rates</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;brentq&#39;</span><span class="p">,</span><span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">xtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="n">rtol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
            <span class="n">hazard_rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">root</span>
        <span class="k">return</span>  <span class="n">hazard_rates</span><span class="p">,</span> <span class="n">sc_dates</span> <span class="c1">#self.create_survival(self.ref_date, sc_dates, hazard_rates)#.value, hazard_rates</span>

    <span class="c1"># def hazard_rates(self):</span>
    <span class="c1">#     #hazard_rates_value=[]</span>
    <span class="c1">#     hazard_rates_value=self.calibrate_hazard_rate()</span>
    <span class="c1">#     return self.hazard_rates_value</span>

    <span class="c1"># def value(self, refdate: Union[date, datetime], d: Union[date, datetime])-&gt;float:</span>
    <span class="c1">#     &quot;&quot;&quot;Return discount factor for a given date</span>

    <span class="c1">#     Args:</span>
    <span class="c1">#         refdate (Union[date, datetime]): The reference date. If the reference date is in the future (compared to the curves reference date), the forward discount factor will be returned.</span>
    <span class="c1">#         d (Union[date, datetime]): The date for which the discount factor will be returned</span>

    <span class="c1">#     Returns:</span>
    <span class="c1">#         float: discount factor</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     #if not isinstance(refdate, datetime):</span>
    <span class="c1">#     #    refdate = datetime(refdate,0,0,0)</span>
    <span class="c1">#     #if not isinstance(d, datetime):</span>
    <span class="c1">#     #    d = datetime(d,0,0,0)</span>
    <span class="c1">#     #if refdate &lt; self.refdate:</span>
    <span class="c1">#     #    raise Exception(&#39;The given reference date is before the curves reference date.&#39;)</span>
    <span class="c1">#     return self._get_pyvacon_obj().value(refdate, d)</span>

    <span class="c1"># def _get_pyvacon_obj(self):</span>
    <span class="c1">#     if self._pyvacon_obj is None:</span>
    <span class="c1">#         self._pyvacon_obj = _SurvivalCurve(&#39;survival_curve&#39;, self.refdate, </span>
    <span class="c1">#                                         self.calibrate_hazard_rate[1], self.calibrate_hazard_rate[0])                                    </span>
    <span class="c1">#     return self._pyvacon_obj</span>

<div class="viewcode-block" id="PowerPriceForwardCurve"><a class="viewcode-back" href="../../../rivapy/marketdata/power.html#rivapy.marketdata.PowerPriceForwardCurve">[docs]</a><span class="k">class</span> <span class="nc">PowerPriceForwardCurve</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">],</span> 
                <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> 
                <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> 
                <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                <span class="n">freq</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;1H&#39;</span><span class="p">,</span>
                <span class="n">tz</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple forward curve for power.</span>

<span class="sd">        Args:</span>
<span class="sd">            refdate (Union[datetime, date]): Reference date of curve</span>
<span class="sd">            start (dt.datetime): Start of forward curve datetimepoints (including this timepoint).</span>
<span class="sd">			end (dt.datetime): End of forad curve datetimepoints (excluding this timepoint).</span>
<span class="sd">            values (np.ndarray): One dimensional array holding the price for each datetimepint in the curve. The method value will raise an exception if the number of values is not equal to the number of datetimepoints.</span>
<span class="sd">			freq (str, optional): Frequency of timepoints. Defaults to &#39;1H&#39;. See documentation for pandas.date_range for further details on freq.</span>
<span class="sd">			tz (str or tzinfo): Time zone name for returning localized datetime points, for example Asia/Hong_Kong. </span>
<span class="sd">								By default, the resulting datetime points are timezone-naive. See documentation for pandas.date_range for further details on tz.</span>
<span class="sd">            id (str): Identifier for the curve. It has no impact on the valuation functionality. If None, a uuid will be generated. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;PFC/&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refdate</span> <span class="o">=</span> <span class="n">refdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tz</span> <span class="o">=</span> <span class="n">tz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="c1"># timegrid used to compute prices for a certain schedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dates&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">(),</span> 
                                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;dates&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
        
<div class="viewcode-block" id="PowerPriceForwardCurve.value"><a class="viewcode-back" href="../../../rivapy/marketdata/power.html#rivapy.marketdata.PowerPriceForwardCurve.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refdate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="n">schedule</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dates&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tz</span><span class="p">,</span> <span class="n">inclusive</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">(),</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The number of dates (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;) does not equal number of values (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;) in forward curve.&#39;</span><span class="p">)</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">dates</span><span class="o">&gt;=</span><span class="n">schedule</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tg</span><span class="o">.</span><span class="n">dates</span><span class="o">&lt;</span><span class="n">schedule</span><span class="o">.</span><span class="n">end</span><span class="p">)]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;dates&#39;</span><span class="p">)</span>
        <span class="n">_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;dates&#39;</span><span class="p">:</span> <span class="n">schedule</span><span class="o">.</span><span class="n">get_schedule</span><span class="p">(</span><span class="n">refdate</span><span class="p">)})</span>
        <span class="n">tg</span> <span class="o">=</span> <span class="n">_schedule</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;dates&#39;</span><span class="p">)</span>
        <span class="c1">#tg = tg[tg[&#39;dates&#39;]&gt;=refdate]</span>
        <span class="k">if</span> <span class="n">tg</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;There are &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; dates in the schedule not covered by the forward curve.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">tg</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span></div>

<div class="viewcode-block" id="PowerPriceForwardCurve.get_df"><a class="viewcode-back" href="../../../rivapy/marketdata/power.html#rivapy.marketdata.PowerPriceForwardCurve.get_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span></div></div>
        

        
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>