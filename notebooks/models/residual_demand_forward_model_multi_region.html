<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multiregion Windpower Model &mdash; rivapy  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Module Documentation" href="../../rivapy/index.html" />
    <link rel="prev" title="Ornstein-Uhlenbeck Model" href="ornstein_uhlenbeck.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            rivapy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Notebook Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lucia_schwartz.html">Lucia-Schwartz Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="ornstein_uhlenbeck.html">Ornstein-Uhlenbeck Model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Multiregion Windpower Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Modelsetup">Modelsetup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Path-Simulation">Path Simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Residual-Demand-Forward-Model">Residual Demand Forward Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#PPA-Hedging">PPA Hedging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Path-Plots">Path Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Hedge-PnL-Distribution">Hedge PnL Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Delta-Plots">Delta Plots</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rivapy/index.html">Module Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sample_data/index.html">Sample and Test Data</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rivapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Notebook Gallery</a></li>
      <li class="breadcrumb-item active">Multiregion Windpower Model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/models/residual_demand_forward_model_multi_region.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Multiregion-Windpower-Model">
<h1>Multiregion Windpower Model<a class="headerlink" href="#Multiregion-Windpower-Model" title="Permalink to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;../..&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">rivapy.tools.datetime_grid</span> <span class="kn">import</span> <span class="n">DateTimeGrid</span>

<span class="kn">from</span> <span class="nn">rivapy.models.residual_demand_fwd_model</span> <span class="kn">import</span> <span class="n">WindPowerForecastModel</span><span class="p">,</span> <span class="n">MultiRegionWindForecastModel</span><span class="p">,</span> <span class="n">ResidualDemandForwardModel</span>


<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&lt;frozen importlib._bootstrap&gt;:228: RuntimeWarning: scipy._lib.messagestream.MessageStream size changed, may indicate binary incompatibility. Expected 56 from C header, got 64 from PyObject
</pre></div></div>
</div>
<section id="Modelsetup">
<h2>Modelsetup<a class="headerlink" href="#Modelsetup" title="Permalink to this heading"></a></h2>
<p>This notebook explains the MultiRegionWindForecastModel class to model the wind in different regions (e.g. for the pricing of greeen PPA).</p>
<p>For this we assume that we have given <span class="math notranslate nohighlight">\(n\)</span> artificial regions…</p>
<p>Let us denote by <span class="math notranslate nohighlight">\(q_i(t,T)\)</span> the wind forecast at time <span class="math notranslate nohighlight">\(t\)</span> for future time <span class="math notranslate nohighlight">\(T\)</span> in region <span class="math notranslate nohighlight">\(i\)</span> (as percentage of maximal capacity for this region) by</p>
<div class="math notranslate nohighlight">
\[q_i(t,T) = E\left[f\left(f^{-1}(q_i(0,T)) + X^i_T-X_0^i\right)\mid X^i_t\right]\]</div>
<p>where <span class="math notranslate nohighlight">\(f\)</span> is an invertible sigmoid function such as the logistic or smoothstep function and <span class="math notranslate nohighlight">\(X_t\)</span> a stochastic process. We define <span class="math notranslate nohighlight">\(\phi^i(T):= f^{-1}(q_i(0,T))-X^i_0\)</span> and get</p>
<div class="math notranslate nohighlight">
\[q_i(t,T) = E\left[f\left(\phi^i(T) + X^i_T\right)\mid X^i_t\right]\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup</span>
<span class="n">wind_region_model</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">vols</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">]</span>
<span class="n">mean_reversion_speed</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">]</span>
<span class="n">capacities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10_000.0</span><span class="p">,</span> <span class="mf">120_000.0</span><span class="p">,</span> <span class="mf">75_000.0</span><span class="p">]</span>
<span class="n">rnd_weights</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],</span>
               <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]</span>
              <span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vols</span><span class="p">)):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">WindPowerForecastModel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;Region_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                            <span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="n">mean_reversion_speed</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                            <span class="n">volatility</span><span class="o">=</span><span class="n">vols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MultiRegionWindForecastModel</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span>
                                    <span class="n">model</span><span class="p">,</span>
                                    <span class="n">capacity</span><span class="o">=</span><span class="n">capacities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                    <span class="n">rnd_weights</span><span class="o">=</span><span class="n">rnd_weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="p">)</span> <span class="p">)</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">MultiRegionWindForecastModel</span><span class="p">(</span><span class="s1">&#39;Wind_Germany&#39;</span><span class="p">,</span> <span class="n">regions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After setting up three regions we just simulate the weather forecast over the next ten days for the following four hours.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_sims</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">days</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number of days</span>
<span class="n">timegrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">days</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">365.0</span><span class="p">,</span> <span class="n">days</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span> <span class="c1"># simulation time grid</span>
<span class="n">forward_expiries</span> <span class="o">=</span> <span class="p">[</span><span class="n">timegrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="mf">365.0</span><span class="o">*</span><span class="mf">24.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span> <span class="c1"># time points for the forwards</span>
<span class="n">rnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">wind</span><span class="o">.</span><span class="n">rnd_shape</span><span class="p">(</span><span class="n">n_sims</span><span class="p">,</span> <span class="n">timegrid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">wind</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">timegrid</span><span class="p">,</span> <span class="n">rnd</span><span class="p">,</span> <span class="n">expiries</span><span class="o">=</span><span class="n">forward_expiries</span><span class="p">,</span>
                                       <span class="n">initial_forecasts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Region_0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
                                                          <span class="s1">&#39;Region_1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                                         <span class="s1">&#39;Region_2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]}</span> <span class="c1"># initial forecast values for the repsective 4 hours</span>
                               <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We get the To obtain the respective simulations we</span>
<span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Region_0_FWD0&#39;,
 &#39;Region_0_FWD1&#39;,
 &#39;Region_0_FWD2&#39;,
 &#39;Region_0_FWD3&#39;,
 &#39;Region_1_FWD0&#39;,
 &#39;Region_1_FWD1&#39;,
 &#39;Region_1_FWD2&#39;,
 &#39;Region_1_FWD3&#39;,
 &#39;Region_2_FWD0&#39;,
 &#39;Region_2_FWD1&#39;,
 &#39;Region_2_FWD2&#39;,
 &#39;Region_2_FWD3&#39;,
 &#39;Wind_Germany_FWD0&#39;,
 &#39;Wind_Germany_FWD1&#39;,
 &#39;Wind_Germany_FWD2&#39;,
 &#39;Wind_Germany_FWD3&#39;}
</pre></div></div>
</div>
</section>
<section id="Path-Simulation">
<h2>Path Simulation<a class="headerlink" href="#Path-Simulation" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Region&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;FWD0&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;efficiency [</span><span class="si">% o</span><span class="s2">f region&#39;s total capacity]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
<span class="c1">#plt.savefig(&#39;wind_efficiency_simulated.png&#39;, dpi=400)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_9_0.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_9_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Region&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;FWD0&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#plt.xlabel(&#39;hour&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;efficiency [</span><span class="si">% o</span><span class="s2">f region&#39;s total capacity]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
<span class="c1">#plt.savefig(&#39;wind_efficiency_dist.png&#39;, dpi=400)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_10_0.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_10_0.png" />
</div>
</div>
<p>The following code cell contains just a snippet to demonstrate how easy one may use geopandas to visualize spatial data (here the wind speed). It is just for demonstration purposes and is in no way meaningful. Follow the instructiosn in the corresponding file to make the next cell run.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geopandas_residual_demand_forward_model</span> <span class="kn">import</span> <span class="n">plot_efficiency_map</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plot_efficiency_map</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="c1">#plt.savefig(&#39;wind_efficiency_map.png&#39;, dpi=400)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_12_0.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_12_0.png" />
</div>
</div>
</section>
</section>
<section id="Residual-Demand-Forward-Model">
<h1>Residual Demand Forward Model<a class="headerlink" href="#Residual-Demand-Forward-Model" title="Permalink to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_onshore</span> <span class="o">=</span> <span class="n">WindPowerForecastModel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;Onshore&#39;</span><span class="p">,</span> <span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="mf">4.80</span><span class="p">)</span>
<span class="n">wind_offshore</span> <span class="o">=</span> <span class="n">WindPowerForecastModel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;Offshore&#39;</span><span class="p">,</span> <span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="mf">4.80</span><span class="p">)</span>
<span class="n">regions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">MultiRegionWindForecastModel</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span>
                                    <span class="n">wind_onshore</span><span class="p">,</span>
                                    <span class="n">capacity</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
                                    <span class="n">rnd_weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]</span>
                                <span class="p">),</span>
           <span class="n">MultiRegionWindForecastModel</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span>
                                    <span class="n">wind_offshore</span><span class="p">,</span>
                                    <span class="n">capacity</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                                    <span class="n">rnd_weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">]</span>
                                <span class="p">)</span>

          <span class="p">]</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">MultiRegionWindForecastModel</span><span class="p">(</span><span class="s1">&#39;Wind_Germany&#39;</span><span class="p">,</span> <span class="n">regions</span><span class="p">)</span>

<span class="n">highest_price</span> <span class="o">=</span> <span class="n">OrnsteinUhlenbeck</span><span class="p">(</span><span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">mean_reversion_level</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">supply_curve</span> <span class="o">=</span> <span class="n">SmoothstepSupplyCurve</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">rd_model</span> <span class="o">=</span> <span class="n">ResidualDemandForwardModel</span><span class="p">(</span><span class="n">wind_power_forecast</span><span class="o">=</span><span class="n">wind</span><span class="p">,</span> <span class="n">highest_price_ou_model</span><span class="o">=</span> <span class="n">highest_price</span><span class="p">,</span>
                                      <span class="n">supply_curve</span><span class="o">=</span><span class="n">supply_curve</span><span class="p">,</span> <span class="n">max_price</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">power_name</span><span class="o">=</span> <span class="s1">&#39;Power_Germany&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">rd_model</span><span class="o">.</span><span class="n">rnd_shape</span><span class="p">(</span><span class="n">n_sims</span><span class="o">=</span><span class="mi">10_000</span><span class="p">,</span> <span class="n">n_timesteps</span><span class="o">=</span><span class="n">timegrid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdm_result</span> <span class="o">=</span> <span class="n">rd_model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">timegrid</span><span class="p">,</span> <span class="n">rnd</span><span class="p">,</span> <span class="n">expiries</span><span class="o">=</span><span class="n">forward_expiries</span><span class="p">,</span> <span class="n">initial_forecasts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Onshore&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
                                                          <span class="s1">&#39;Offshore&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdm_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Power_Germany:0&#39;</span><span class="p">,</span> <span class="n">forecast_timepoints</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.26666667, 0.26666667, 0.26666667, ..., 0.26666667, 0.26666667,
        0.26666667],
       [0.26021478, 0.27070423, 0.26975393, ..., 0.26509957, 0.26823855,
        0.26438372],
       [0.25406328, 0.27815923, 0.27138286, ..., 0.26864876, 0.26813227,
        0.27003154],
       ...,
       [0.28389246, 0.29749926, 0.24491791, ..., 0.28798642, 0.24734741,
        0.23657972],
       [0.28392222, 0.29742968, 0.24492363, ..., 0.28800452, 0.24734926,
        0.23654951],
       [0.28392685, 0.29743316, 0.24492425, ..., 0.28804524, 0.24733697,
        0.23655771]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rd_model</span><span class="o">.</span><span class="n">udls</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Offshore&#39;, &#39;Onshore&#39;, &#39;Power_Germany&#39;, &#39;Wind_Germany&#39;}
</pre></div></div>
</div>
</section>
<section id="PPA-Hedging">
<h1>PPA Hedging<a class="headerlink" href="#PPA-Hedging" title="Permalink to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;hedge_results.json&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rivapy.tools.interfaces</span> <span class="kn">import</span> <span class="n">FactoryObject</span>

<span class="k">def</span> <span class="nf">compute_pnl_figures</span><span class="p">(</span><span class="n">pricing_results</span><span class="p">):</span>
    <span class="n">pnl</span> <span class="o">=</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">compute_pnl</span><span class="p">(</span><span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">payoff</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">pnl</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">pnl</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="s1">&#39;1%&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">pnl</span><span class="p">,)</span> <span class="s1">&#39;99%&#39;</span><span class="p">}</span>
<span class="k">def</span> <span class="nf">run_hedge_experiment</span><span class="p">(</span><span class="n">val_date</span><span class="p">,</span> <span class="n">ppa_spec</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ppa_spec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppa_spec</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ppa_spec_hash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppa_spec</span><span class="o">.</span><span class="n">hash</span><span class="p">()</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;model_hash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hash</span><span class="p">()</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;pricing_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
    <span class="n">hash_key</span> <span class="o">=</span> <span class="n">FactoryObject</span><span class="o">.</span><span class="n">hash_for_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="c1">#if hash_key in results:</span>

    <span class="n">pricing_result</span> <span class="o">=</span>  <span class="n">GreenPPADeepHedgingPricer</span><span class="o">.</span><span class="n">price</span><span class="p">(</span><span class="n">val_date</span><span class="p">,</span>
                                  <span class="n">ppa_spec</span><span class="p">,</span>
                                  <span class="n">model</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_onshore</span> <span class="o">=</span> <span class="n">WindPowerForecastModel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;Onshore&#39;</span><span class="p">,</span> <span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="mf">4.80</span><span class="p">)</span>
<span class="n">wind_offshore</span> <span class="o">=</span> <span class="n">WindPowerForecastModel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;Offshore&#39;</span><span class="p">,</span> <span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="mf">4.80</span><span class="p">)</span>
<span class="n">regions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">MultiRegionWindForecastModel</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span>
                                    <span class="n">wind_onshore</span><span class="p">,</span>
                                    <span class="n">capacity</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
                                    <span class="n">rnd_weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]</span>
                                <span class="p">),</span>
           <span class="n">MultiRegionWindForecastModel</span><span class="o">.</span><span class="n">Region</span><span class="p">(</span>
                                    <span class="n">wind_offshore</span><span class="p">,</span>
                                    <span class="n">capacity</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                                    <span class="n">rnd_weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">]</span>
                                <span class="p">)</span>

          <span class="p">]</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">MultiRegionWindForecastModel</span><span class="p">(</span><span class="s1">&#39;Wind_Germany&#39;</span><span class="p">,</span> <span class="n">regions</span><span class="p">)</span>
<span class="n">highest_price</span> <span class="o">=</span> <span class="n">OrnsteinUhlenbeck</span><span class="p">(</span><span class="n">speed_of_mean_reversion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">mean_reversion_level</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">supply_curve</span> <span class="o">=</span> <span class="n">SmoothstepSupplyCurve</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">rd_model</span> <span class="o">=</span> <span class="n">ResidualDemandForwardModel</span><span class="p">(</span><span class="n">wind_power_forecast</span><span class="o">=</span><span class="n">wind</span><span class="p">,</span> <span class="n">highest_price_ou_model</span><span class="o">=</span> <span class="n">highest_price</span><span class="p">,</span>
                                      <span class="n">supply_curve</span><span class="o">=</span><span class="n">supply_curve</span><span class="p">,</span> <span class="n">max_price</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">power_name</span><span class="o">=</span> <span class="s1">&#39;Power_Germany&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">strike</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1">#0.22</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">GreenPPASpecification</span><span class="p">(</span><span class="n">udl</span><span class="o">=</span><span class="s1">&#39;Power_Germany&#39;</span><span class="p">,</span>
                            <span class="n">technology</span> <span class="o">=</span> <span class="s1">&#39;Wind&#39;</span><span class="p">,</span>
                             <span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;Onshore&#39;</span><span class="p">,</span>
                             <span class="n">schedule</span> <span class="o">=</span> <span class="p">[</span><span class="n">val_date</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">)],</span>
                             <span class="n">fixed_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
                             <span class="n">max_capacity</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;depp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING:tensorflow:Compiled the loaded model, but the compiled metrics have yet to be built. `model.compile_metrics` will be empty until you train or evaluate the model.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:absl:Function `_wrapped_model` contains input name(s) Power_Germany_FWD0, Onshore_FWD0, Offshore_FWD0 with unsupported characters which will be renamed to power_germany_fwd0, onshore_fwd0, offshore_fwd0 in the SavedModel.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
INFO:tensorflow:Assets written to: depp/delta_model\assets
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:tensorflow:Assets written to: depp/delta_model\assets
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DeepHedgeModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;depp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pricing_results</span> <span class="o">=</span> <span class="n">run_hedge_experiment</span><span class="p">(</span><span class="n">val_date</span><span class="p">,</span>
                                      <span class="n">spec</span><span class="p">,</span>
                                      <span class="n">rd_model</span><span class="p">,</span>
                                        <span class="n">initial_forecasts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Onshore&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
                                                            <span class="s1">&#39;Offshore&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">]},</span>
                                        <span class="n">forecast_hours</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span>
                                        <span class="n">additional_states</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Offshore&#39;</span><span class="p">],</span>
                                          <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nb_neurons</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_sims</span><span class="o">=</span><span class="mi">10_000</span><span class="p">,</span>
                                        <span class="n">regularization</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                          <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">tensorboard_logdir</span> <span class="o">=</span> <span class="s1">&#39;logs/&#39;</span> <span class="o">+</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">T%H%M%S&quot;</span><span class="p">),</span>
                                        <span class="n">initial_lr</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span>
                                        <span class="n">decay_steps</span><span class="o">=</span><span class="mi">8_000</span><span class="p">,</span>
                                          <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4568d6a64044c5ca102f46bdc0f3b8a7400d5607
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\doeltz\development\RiVaPy\notebooks\models\../..\rivapy\tools\datetime_grid.py:24: FutureWarning: Argument `closed` is deprecated in favor of `inclusive`.
  self.dates = pd.date_range(start, end, freq=freq, tz=tz, closed=closed).to_pydatetime()
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/200
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">KeyboardInterrupt</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-intense-fg ansi-bold">In [20], line 1</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 1</span> pricing_results <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">run_hedge_experiment</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">val_date</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">      2</span> <span class="ansi-yellow-bg">                                      </span><span class="ansi-yellow-bg">spec</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">      3</span> <span class="ansi-yellow-bg">                                      </span><span class="ansi-yellow-bg">rd_model</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">      4</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">initial_forecasts</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">{</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Onshore</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.8</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.7</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.6</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.5</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-yellow-bg">                                                            </span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Offshore</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.6</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.6</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.6</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.6</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">}</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      6</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">forecast_hours</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">14</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">18</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      7</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">additional_states</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Offshore</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      8</span> <span class="ansi-yellow-bg">                                          </span><span class="ansi-yellow-bg">depth</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">3</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">nb_neurons</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">32</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">n_sims</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">10_000</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">      9</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">regularization</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.0</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     10</span> <span class="ansi-yellow-bg">                                          </span><span class="ansi-yellow-bg">epochs</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">200</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">verbose</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">1</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     11</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">tensorboard_logdir</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">logs/</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#39;</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">+</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dt</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">datetime</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">now</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">strftime</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">%</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">Y</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">%</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">m</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(175,95,135)">%d</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">T</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">%</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">H</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">%</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">M</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">%</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">S</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">     12</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">initial_lr</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">5e-4</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     13</span> <span class="ansi-yellow-bg">                                        </span><span class="ansi-yellow-bg">decay_steps</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">8_000</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     14</span> <span class="ansi-yellow-bg">                                          </span><span class="ansi-yellow-bg">batch_size</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">100</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">decay_rate</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">0.8</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">seed</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">42</span><span class="ansi-yellow-bg">)</span>

Cell <span class="ansi-green-intense-fg ansi-bold">In [19], line 14</span>, in <span class="ansi-cyan-fg">run_hedge_experiment</span><span class="ansi-blue-intense-fg ansi-bold">(val_date, ppa_spec, model, **kwargs)</span>
<span class="ansi-green-fg">     12</span> params[<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">pricing_param</span><span style="color: rgb(175,0,0)">&#39;</span>] <span style="color: rgb(98,98,98)">=</span> kwargs
<span class="ansi-green-fg">     13</span> <span style="color: rgb(0,135,0)">print</span>(FactoryObject<span style="color: rgb(98,98,98)">.</span>hash_for_dict(params))
<span class="ansi-green-intense-fg ansi-bold">---&gt; 14</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> GreenPPADeepHedgingPricer<span style="color: rgb(98,98,98)">.</span>price(val_date,
<span class="ansi-green-fg">     15</span>                               ppa_spec,
<span class="ansi-green-fg">     16</span>                               model,<span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)

File <span class="ansi-green-intense-fg ansi-bold">~\development\RiVaPy\notebooks\models\../..\rivapy\pricing\green_ppa_pricing.py:475</span>, in <span class="ansi-cyan-fg">GreenPPADeepHedgingPricer.price</span><span class="ansi-blue-intense-fg ansi-bold">(val_date, green_ppa, power_wind_model, initial_forecasts, forecast_hours, depth, nb_neurons, n_sims, regularization, epochs, verbose, tensorboard_logdir, initial_lr, batch_size, decay_rate, decay_steps, seed, additional_states, paths)</span>
<span class="ansi-green-fg">    467</span> lr_schedule <span style="color: rgb(98,98,98)">=</span> tf<span style="color: rgb(98,98,98)">.</span>keras<span style="color: rgb(98,98,98)">.</span>optimizers<span style="color: rgb(98,98,98)">.</span>schedules<span style="color: rgb(98,98,98)">.</span>ExponentialDecay(
<span class="ansi-green-fg">    468</span>         initial_learning_rate<span style="color: rgb(98,98,98)">=</span>initial_lr,<span style="color: rgb(95,135,135)">#1e-3,</span>
<span class="ansi-green-fg">    469</span>         decay_steps<span style="color: rgb(98,98,98)">=</span>decay_steps,
<span class="ansi-green-fg">    470</span>         decay_rate<span style="color: rgb(98,98,98)">=</span>decay_rate,
<span class="ansi-green-fg">    471</span>         staircase<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>)
<span class="ansi-green-fg">    473</span> payoff <span style="color: rgb(98,98,98)">=</span> GreenPPADeepHedgingPricer<span style="color: rgb(98,98,98)">.</span>compute_payoff(n_sims, hedge_ins, additional_states_, green_ppa)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 475</span> <span class="ansi-yellow-bg">hedge_model</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">train</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">paths</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">payoff</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">lr_schedule</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">epochs</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">epochs</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">batch_size</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">batch_size</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">tensorboard_log</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">tensorboard_logdir</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">verbose</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">verbose</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    476</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> GreenPPADeepHedgingPricer<span style="color: rgb(98,98,98)">.</span>PricingResults(hedge_model, paths<span style="color: rgb(98,98,98)">=</span>paths, sim_results<span style="color: rgb(98,98,98)">=</span>simulation_results, payoff<span style="color: rgb(98,98,98)">=</span>payoff)

File <span class="ansi-green-intense-fg ansi-bold">~\development\RiVaPy\notebooks\models\../..\rivapy\pricing\green_ppa_pricing.py:150</span>, in <span class="ansi-cyan-fg">DeepHedgeModel.train</span><span class="ansi-blue-intense-fg ansi-bold">(self, paths, payoff, lr_schedule, epochs, batch_size, tensorboard_log, verbose)</span>
<span class="ansi-green-fg">    148</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>compile(optimizer<span style="color: rgb(98,98,98)">=</span>optimizer, loss<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>custom_loss)
<span class="ansi-green-fg">    149</span> inputs <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_create_inputs(paths)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 150</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">fit</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">inputs</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">payoff</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">epochs</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">epochs</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span>
<span class="ansi-green-fg">    151</span> <span class="ansi-yellow-bg">                    </span><span class="ansi-yellow-bg">batch_size</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">batch_size</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">callbacks</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">callbacks</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">verbose</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">verbose</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\keras\utils\traceback_utils.py:65</span>, in <span class="ansi-cyan-fg">filter_traceback.&lt;locals&gt;.error_handler</span><span class="ansi-blue-intense-fg ansi-bold">(*args, **kwargs)</span>
<span class="ansi-green-fg">     63</span> filtered_tb <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">     64</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-intense-fg ansi-bold">---&gt; 65</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> fn(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">     66</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:
<span class="ansi-green-fg">     67</span>     filtered_tb <span style="color: rgb(98,98,98)">=</span> _process_traceback_frames(e<span style="color: rgb(98,98,98)">.</span>__traceback__)

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\keras\engine\training.py:1564</span>, in <span class="ansi-cyan-fg">Model.fit</span><span class="ansi-blue-intense-fg ansi-bold">(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_batch_size, validation_freq, max_queue_size, workers, use_multiprocessing)</span>
<span class="ansi-green-fg">   1556</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> tf<span style="color: rgb(98,98,98)">.</span>profiler<span style="color: rgb(98,98,98)">.</span>experimental<span style="color: rgb(98,98,98)">.</span>Trace(
<span class="ansi-green-fg">   1557</span>     <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">train</span><span style="color: rgb(175,0,0)">&#34;</span>,
<span class="ansi-green-fg">   1558</span>     epoch_num<span style="color: rgb(98,98,98)">=</span>epoch,
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">   1561</span>     _r<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">1</span>,
<span class="ansi-green-fg">   1562</span> ):
<span class="ansi-green-fg">   1563</span>     callbacks<span style="color: rgb(98,98,98)">.</span>on_train_batch_begin(step)
<span class="ansi-green-intense-fg ansi-bold">-&gt; 1564</span>     tmp_logs <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">train_function</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">iterator</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1565</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> data_handler<span style="color: rgb(98,98,98)">.</span>should_sync:
<span class="ansi-green-fg">   1566</span>         context<span style="color: rgb(98,98,98)">.</span>async_wait()

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\util\traceback_utils.py:150</span>, in <span class="ansi-cyan-fg">filter_traceback.&lt;locals&gt;.error_handler</span><span class="ansi-blue-intense-fg ansi-bold">(*args, **kwargs)</span>
<span class="ansi-green-fg">    148</span> filtered_tb <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">    149</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-intense-fg ansi-bold">--&gt; 150</span>   <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> fn(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">    151</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">Exception</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:
<span class="ansi-green-fg">    152</span>   filtered_tb <span style="color: rgb(98,98,98)">=</span> _process_traceback_frames(e<span style="color: rgb(98,98,98)">.</span>__traceback__)

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\eager\def_function.py:915</span>, in <span class="ansi-cyan-fg">Function.__call__</span><span class="ansi-blue-intense-fg ansi-bold">(self, *args, **kwds)</span>
<span class="ansi-green-fg">    912</span> compiler <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">xla</span><span style="color: rgb(175,0,0)">&#34;</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_jit_compile <span class="ansi-bold" style="color: rgb(0,135,0)">else</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">nonXla</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-fg">    914</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> OptionalXlaContext(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_jit_compile):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 915</span>   result <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_call(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwds)
<span class="ansi-green-fg">    917</span> new_tracing_count <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>experimental_get_tracing_count()
<span class="ansi-green-fg">    918</span> without_tracing <span style="color: rgb(98,98,98)">=</span> (tracing_count <span style="color: rgb(98,98,98)">==</span> new_tracing_count)

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\eager\def_function.py:963</span>, in <span class="ansi-cyan-fg">Function._call</span><span class="ansi-blue-intense-fg ansi-bold">(self, *args, **kwds)</span>
<span class="ansi-green-fg">    960</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">    961</span>   <span style="color: rgb(95,135,135)"># This is the first call of __call__, so we have to initialize.</span>
<span class="ansi-green-fg">    962</span>   initializers <span style="color: rgb(98,98,98)">=</span> []
<span class="ansi-green-intense-fg ansi-bold">--&gt; 963</span>   <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_initialize</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">add_initializers_to</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">initializers</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    964</span> <span class="ansi-bold" style="color: rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg">    965</span>   <span style="color: rgb(95,135,135)"># At this point we know that the initialization is complete (or less</span>
<span class="ansi-green-fg">    966</span>   <span style="color: rgb(95,135,135)"># interestingly an exception was raised) so we no longer need a lock.</span>
<span class="ansi-green-fg">    967</span>   <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_lock<span style="color: rgb(98,98,98)">.</span>release()

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\eager\def_function.py:785</span>, in <span class="ansi-cyan-fg">Function._initialize</span><span class="ansi-blue-intense-fg ansi-bold">(self, args, kwds, add_initializers_to)</span>
<span class="ansi-green-fg">    782</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_lifted_initializer_graph <span style="color: rgb(98,98,98)">=</span> lifted_initializer_graph
<span class="ansi-green-fg">    783</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_graph_deleter <span style="color: rgb(98,98,98)">=</span> FunctionDeleter(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_lifted_initializer_graph)
<span class="ansi-green-fg">    784</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_concrete_stateful_fn <span style="color: rgb(98,98,98)">=</span> (
<span class="ansi-green-intense-fg ansi-bold">--&gt; 785</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_stateful_fn<span style="color: rgb(98,98,98)">.</span>_get_concrete_function_internal_garbage_collected(  <span style="color: rgb(95,135,135)"># pylint: disable=protected-access</span>
<span class="ansi-green-fg">    786</span>         <span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwds))
<span class="ansi-green-fg">    788</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">invalid_creator_scope</span>(<span style="color: rgb(98,98,98)">*</span>unused_args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>unused_kwds):
<span class="ansi-green-fg">    789</span>   <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Disables variable creation.&#34;&#34;&#34;</span>

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\eager\function.py:2523</span>, in <span class="ansi-cyan-fg">Function._get_concrete_function_internal_garbage_collected</span><span class="ansi-blue-intense-fg ansi-bold">(self, *args, **kwargs)</span>
<span class="ansi-green-fg">   2521</span>   args, kwargs <span style="color: rgb(98,98,98)">=</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>, <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">   2522</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_lock:
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2523</span>   graph_function, _ <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_maybe_define_function</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2524</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> graph_function

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\eager\function.py:2760</span>, in <span class="ansi-cyan-fg">Function._maybe_define_function</span><span class="ansi-blue-intense-fg ansi-bold">(self, args, kwargs)</span>
<span class="ansi-green-fg">   2758</span>   <span style="color: rgb(95,135,135)"># Only get placeholders for arguments, not captures</span>
<span class="ansi-green-fg">   2759</span>   args, kwargs <span style="color: rgb(98,98,98)">=</span> placeholder_dict[<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">args</span><span style="color: rgb(175,0,0)">&#34;</span>]
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2760</span> graph_function <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_create_graph_function</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2762</span> graph_capture_container <span style="color: rgb(98,98,98)">=</span> graph_function<span style="color: rgb(98,98,98)">.</span>graph<span style="color: rgb(98,98,98)">.</span>_capture_func_lib  <span style="color: rgb(95,135,135)"># pylint: disable=protected-access</span>
<span class="ansi-green-fg">   2763</span> <span style="color: rgb(95,135,135)"># Maintain the list of all captures</span>

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\eager\function.py:2670</span>, in <span class="ansi-cyan-fg">Function._create_graph_function</span><span class="ansi-blue-intense-fg ansi-bold">(self, args, kwargs)</span>
<span class="ansi-green-fg">   2665</span> missing_arg_names <span style="color: rgb(98,98,98)">=</span> [
<span class="ansi-green-fg">   2666</span>     <span style="color: rgb(175,0,0)">&#34;</span><span class="ansi-bold" style="color: rgb(175,95,135)">%s</span><span style="color: rgb(175,0,0)">_</span><span class="ansi-bold" style="color: rgb(175,95,135)">%d</span><span style="color: rgb(175,0,0)">&#34;</span> <span style="color: rgb(98,98,98)">%</span> (arg, i) <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> i, arg <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">enumerate</span>(missing_arg_names)
<span class="ansi-green-fg">   2667</span> ]
<span class="ansi-green-fg">   2668</span> arg_names <span style="color: rgb(98,98,98)">=</span> base_arg_names <span style="color: rgb(98,98,98)">+</span> missing_arg_names
<span class="ansi-green-fg">   2669</span> graph_function <span style="color: rgb(98,98,98)">=</span> ConcreteFunction(
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2670</span>     <span class="ansi-yellow-bg">func_graph_module</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">func_graph_from_py_func</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">   2671</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_name</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2672</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_python_function</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2673</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2674</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2675</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">input_signature</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2676</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">autograph</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_autograph</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2677</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">autograph_options</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_autograph_options</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2678</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">arg_names</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">arg_names</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">   2679</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">capture_by_value</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_capture_by_value</span><span class="ansi-yellow-bg">)</span>,
<span class="ansi-green-fg">   2680</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_function_attributes,
<span class="ansi-green-fg">   2681</span>     spec<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>function_spec,
<span class="ansi-green-fg">   2682</span>     <span style="color: rgb(95,135,135)"># Tell the ConcreteFunction to clean up its graph once it goes out of</span>
<span class="ansi-green-fg">   2683</span>     <span style="color: rgb(95,135,135)"># scope. This is not the default behavior since it gets used in some</span>
<span class="ansi-green-fg">   2684</span>     <span style="color: rgb(95,135,135)"># places (like Keras) where the FuncGraph lives longer than the</span>
<span class="ansi-green-fg">   2685</span>     <span style="color: rgb(95,135,135)"># ConcreteFunction.</span>
<span class="ansi-green-fg">   2686</span>     shared_func_graph<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">   2687</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> graph_function

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\framework\func_graph.py:1153</span>, in <span class="ansi-cyan-fg">func_graph_from_py_func</span><span class="ansi-blue-intense-fg ansi-bold">(name, python_func, args, kwargs, signature, func_graph, autograph, autograph_options, add_control_dependencies, arg_names, op_return_value, collections, capture_by_value, acd_record_initial_resource_uses)</span>
<span class="ansi-green-fg">   1150</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">   1151</span>   deps_control_manager <span style="color: rgb(98,98,98)">=</span> ops<span style="color: rgb(98,98,98)">.</span>NullContextmanager()
<span class="ansi-green-intense-fg ansi-bold">-&gt; 1153</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> func_graph<span style="color: rgb(98,98,98)">.</span>as_default(), deps_control_manager <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> deps_ctx:
<span class="ansi-green-fg">   1154</span>   current_scope <span style="color: rgb(98,98,98)">=</span> variable_scope<span style="color: rgb(98,98,98)">.</span>get_variable_scope()
<span class="ansi-green-fg">   1155</span>   default_use_resource <span style="color: rgb(98,98,98)">=</span> current_scope<span style="color: rgb(98,98,98)">.</span>use_resource

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\framework\auto_control_deps.py:528</span>, in <span class="ansi-cyan-fg">AutomaticControlDependencies.__exit__</span><span class="ansi-blue-intense-fg ansi-bold">(self, unused_type, unused_value, unused_traceback)</span>
<span class="ansi-green-fg">    525</span>   last_write_to_resource[<span class="ansi-bold" style="color: rgb(0,135,0)">None</span>] <span style="color: rgb(98,98,98)">=</span> op
<span class="ansi-green-fg">    527</span> <span style="color: rgb(95,135,135)"># Ensure ordering of collective ops</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 528</span> manager_ids <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">collective_manager_ids_from_op</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    529</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> manager_id <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> manager_ids:
<span class="ansi-green-fg">    530</span>   <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> manager_id <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> collective_manager_scopes_opened:
<span class="ansi-green-fg">    531</span>     <span style="color: rgb(95,135,135)"># Chain this function call if the scope was opened.</span>

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\framework\auto_control_deps.py:171</span>, in <span class="ansi-cyan-fg">collective_manager_ids_from_op</span><span class="ansi-blue-intense-fg ansi-bold">(op)</span>
<span class="ansi-green-fg">    158</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">collective_manager_ids_from_op</span>(op):
<span class="ansi-green-fg">    159</span>   <span style="color: rgb(175,0,0)">&#34;&#34;&#34;Returns CollectiveManager ID from the op if one exists, else None.</span>
<span class="ansi-green-fg">    160</span>
<span class="ansi-green-fg">    161</span> <span style="color: rgb(175,0,0)">  CollectiveManager adds collective and no_op operations tagged with an ID,</span>
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">    169</span> <span style="color: rgb(175,0,0)">    List of CollectiveManager IDs used by the op.</span>
<span class="ansi-green-fg">    170</span> <span style="color: rgb(175,0,0)">  &#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 171</span>   <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-yellow-bg">op</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">type</span> <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">CollectiveReduce</span><span style="color: rgb(175,0,0)">&#34;</span>:
<span class="ansi-green-fg">    172</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">    173</span>       <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> [op<span style="color: rgb(98,98,98)">.</span>get_attr(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">_collective_manager_id</span><span style="color: rgb(175,0,0)">&#34;</span>)]

File <span class="ansi-green-intense-fg ansi-bold">~\software\anaconda3\envs\tf\lib\site-packages\tensorflow\python\framework\ops.py:2583</span>, in <span class="ansi-cyan-fg">Operation.type</span><span class="ansi-blue-intense-fg ansi-bold">(self)</span>
<span class="ansi-green-fg">   2580</span> <span style="color: rgb(175,0,255)">@property</span>
<span class="ansi-green-fg">   2581</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">type</span>(<span style="color: rgb(0,135,0)">self</span>):
<span class="ansi-green-fg">   2582</span>   <span style="color: rgb(175,0,0)">&#34;&#34;&#34;The type of the op (e.g. `&#34;MatMul&#34;`).&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2583</span>   <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">pywrap_tf_session</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">TF_OperationOpType</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">_c_op</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-red-intense-fg ansi-bold">KeyboardInterrupt</span>:
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="c1">#ttm</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;Power_Germany_FWD0&#39;, &#39;Onshore_FWD0&#39;, &#39;Offshore_FWD0&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="mi">48</span>
<span class="n">p</span><span class="o">=</span><span class="mf">10.0</span>
<span class="n">projection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="n">projected_key</span> <span class="o">=</span> <span class="s1">&#39;Onshore_FWD0&#39;</span>
<span class="k">for</span> <span class="n">selected</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">400</span><span class="p">]:</span>
<span class="c1">#selected = 2</span>
    <span class="c1">#key = &#39;Power_Germany_FWD0&#39;</span>
    <span class="c1">#x = np.percentile(pricing_results.paths[key][-1,:],p)</span>
    <span class="c1">#selected = np.abs(x-pricing_results.paths[key][-1,:]).argmin()</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">timegrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ttm</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">timegrid</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">/</span><span class="n">T</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">projected_key</span><span class="p">:</span>
            <span class="n">paths</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">projection</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">selected</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">projection</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">selected</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paths</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">selected</span><span class="p">])</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">compute_delta</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">ttm</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">projected_key</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;delta&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
8/8 [==============================] - 0s 3ms/step
8/8 [==============================] - 0s 3ms/step
8/8 [==============================] - 0s 2ms/step
8/8 [==============================] - 0s 1ms/step
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_27_1.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_27_1.png" />
</div>
</div>
<section id="Path-Plots">
<h2>Path Plots<a class="headerlink" href="#Path-Plots" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">n_x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span><span class="n">n_y</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="n">l</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;, t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">w</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;, t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="s1">&#39;, t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_29_0.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_29_0.png" />
</div>
</div>
</section>
<section id="Hedge-PnL-Distribution">
<h2>Hedge PnL Distribution<a class="headerlink" href="#Hedge-PnL-Distribution" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pnl</span> <span class="o">=</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">compute_pnl</span><span class="p">(</span><span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">payoff</span><span class="p">)</span>

<span class="c1">#plt.hist(pricing_results.payoff, bins=100, alpha=0.5, density=True)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pnl</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
313/313 [==============================] - 8s 4ms/step
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_31_1.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_31_1.png" />
</div>
</div>
</section>
<section id="Delta-Plots">
<h2>Delta Plots<a class="headerlink" href="#Delta-Plots" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n_x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">hedge_model</span><span class="o">.</span><span class="n">compute_delta</span><span class="p">(</span><span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">delta</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;, t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;delta&#39;</span><span class="p">)</span>
    <span class="n">i</span><span class="o">+=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">pricing_results</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">,:],</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;, t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;, final&#39;</span><span class="p">)</span>
    <span class="n">i</span><span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
313/313 [==============================] - 1s 2ms/step
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_models_residual_demand_forward_model_multi_region_33_1.png" src="../../_images/notebooks_models_residual_demand_forward_model_multi_region_33_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ornstein_uhlenbeck.html" class="btn btn-neutral float-left" title="Ornstein-Uhlenbeck Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../rivapy/index.html" class="btn btn-neutral float-right" title="Module Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>